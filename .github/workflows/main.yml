name: Auto Merge to Master

on:
  push:
    branches:
      - develop

jobs:
  auto-merge:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v4  # Update to the latest version that supports Node.js 16
      with:
        node-version: 16

    - name: Create Pull Request
      uses: actions/github-script@v4
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const title = 'Automated Merge from develop to master';
          const body = 'This is an automated pull request.';
          const head = 'develop';
          const base = 'master';

          const pr = await github.pulls.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title,
            body,
            head,
            base,
          });

          core.setOutput('pull_request_number', pr.data.number);

    - name: Auto Approve Pull Request
      uses: actions/github-script@v4
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          await github.pulls.createReview({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: core.getInput('pull_request_number'),
            event: 'APPROVE',
          });

    - name: Merge Pull Request
      uses: actions/github-script@v4
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          await github.pulls.merge({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: core.getInput('pull_request_number'),
          });
