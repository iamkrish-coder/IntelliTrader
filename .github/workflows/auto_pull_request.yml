name: Auto Pull Request
on:
  push:
    branches:
      - develop

jobs:
  PR:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: master

      - name: Check if file exists
        id: check_file
        run: |
          if [ -f "open_pr.json" ]; then
            echo "File exists"
            exit 0
          else
            echo "File does not exist"
            exit 0  # Exit with code 0 to indicate success even if the file does not exist
          fi

      - name: Get latest commit message
        id: latest_commit
        run: echo "::set-output name=message::$(git log --format=%B -n 1 HEAD)"

      - name: Create Pull Request (if file exists)
        id: cpr
        uses: peter-evans/create-pull-request@v5
        if: steps.check_file.outputs.run == 'File exists'
        with:
          branch: feature-build
          title: ${{ steps.latest_commit.outputs.message }} 
          body: |
            Updates to IntelliTrader
            - Srikrishnan
            - Auto-generated Pull Request on push to Develop

          delete-branch: true
          labels: |
            enhancement
            automated pull request
          assignees: iamkrish-coder
          draft: false
